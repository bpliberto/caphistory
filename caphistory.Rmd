---
title: "caphistory"
author: "Bethany Liberto"
date: "June 16, 2019"
output:
  word_document: default
---

Using CJS and JS. JS -> for population estimates. CJS -> for time-dependent survival and recapture rates of a given species 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T,
                      results = "hide") ##This just hides outputs when knitting because it was like 60 pages
options(warn=-1) ##This hides warnings, again, just really for knitting. Can be turned back on with warn=0
```
  
  
```{r}
library(marked)
library(RMark)
library(ggplot2)
```


```{r}
cap <- read.csv("capturehistory.csv", stringsAsFactors = F)
str(cap)
print(cap)
summary(cap)
cap <- cap[which(!is.na(cap$c1)), ]
summary(cap)
```

## Format data for MARK

```{r, eval=FALSE}
library(reshape)

# get data formatted for MARK/RMark
cap$ch <- paste(cap$c1,
                cap$c2,
                cap$c3,
                cap$c4,
                cap$c5,
                cap$c6,
                cap$c7,
                cap$c8,
                cap$c9,
                cap$c10,
                cap$c11,
                " ",
                ";",
                sep="")


data=data.frame(cap)
data
transform=melt(cap, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot
```

## Format data for marked package

```{r}

marked_df <- cap

marked_df$ch <- paste0(cap$c1,
                cap$c2,
                cap$c3,
                cap$c4,
                cap$c5,
                cap$c6,
                cap$c7,
                cap$c8,
                cap$c9,
                cap$c10,
                cap$c11)
                
model=crm(marked_df)
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_df)
marked_df$sex.fac <- as.factor(marked_df$sex)
marked_df$species.fac <- as.factor(marked_df$species)
mod <- crm(marked_df, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
mod$results$beta #found online but not sure how to use it
mod

cjs.hessian(mod)

str(mod)
# get values on real scale and not logit or log scales
mod$results$reals


mod <- crm(marked_df, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
mod$results$beta 
mod
mod$results$reals
```


looking at location and species

```{r}
str(marked_df)
marked_df$location.fac <- as.factor(marked_df$location)
marked_df$species.fac <- as.factor(marked_df$species)
mod <- crm(marked_df, 
        model="JS", 
        groups = c("location.fac"), 
        model.parameters=list(Phi = list(formula = ~location.fac), 
                              p = list(formula = ~1)))
mod$results$beta #found online but not sure how to use it
mod

cjs.hessian(mod)

str(mod)
# get values on real scale and not logit or log scales
mod$results$reals


mod <- crm(marked_df, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
mod$results$beta 
mod
mod$results$reals
```



need to look at just crimsons and hudsonians and their habitats. First looking at Crimsons

```{r}
cap <- read.csv("capturehistoryCrimsons.csv", stringsAsFactors = F)
str(cap)
print(cap)
summary(cap)
cap <- cap[which(!is.na(cap$c1)), ]
summary(cap)

library(reshape)

# get data formatted for MARK/RMark
cap$ch <- paste(cap$c1,
                cap$c2,
                cap$c3,
                cap$c4,
                cap$c5,
                cap$c6,
                cap$c7,
                cap$c8,
                cap$c9,
                cap$c10,
                cap$c11,
                " ",
                ";",
                sep="")


data=data.frame(cap)
data
transform=melt(cap, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot
```

CJS of just Crimsons

```{r}
marked_dfC <- cap #of Crimsons

marked_dfC$ch <- paste0(cap$c1,
                cap$c2,
                cap$c3,
                cap$c4,
                cap$c5,
                cap$c6,
                cap$c7,
                cap$c8,
                cap$c9,
                cap$c10,
                cap$c11)
                
model=crm(marked_dfC)
model
model=cjs.hessian(model)
model
```


Crimsons location. Had to get rid of species fact stuff since this only has Crimsons


```{r}
str(marked_dfC)
marked_dfC$location.fac <- as.factor(marked_dfC$location)
marked_dfC$species.fac <- as.factor(marked_dfC$species)
modC <- crm(marked_dfC, 
        model="JS", 
        groups = c("location.fac"), 
        model.parameters=list(Phi = list(formula = ~location.fac), 
                              p = list(formula = ~1)))
modC$results$beta #found online but not sure how to use it
modC

cjs.hessian(modC)

str(modC)
# get values on real scale and not logit or log scales
mod$results$reals


modC$results$beta 
modC
modC$results$reals
```





need to look at just crimsons and hudsonians and their habitats. Looking at Hudsonians

```{r}
cap <- read.csv("capturehistoryHudsonians.csv", stringsAsFactors = F)
str(cap)
print(cap)
summary(cap)
cap <- cap[which(!is.na(cap$c1)), ]
summary(cap)

library(reshape)

# get data formatted for MARK/RMark
cap$ch <- paste(cap$c1,
                cap$c2,
                cap$c3,
                cap$c4,
                cap$c5,
                cap$c6,
                cap$c7,
                cap$c8,
                cap$c9,
                cap$c10,
                cap$c11,
                " ",
                ";",
                sep="")


data=data.frame(cap)
data
transform=melt(cap, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot
```

CJS of just Hudsonians

```{r}
marked_dfH <- cap #of Hudsonians

marked_dfH$ch <- paste0(cap$c1,
                cap$c2,
                cap$c3,
                cap$c4,
                cap$c5,
                cap$c6,
                cap$c7,
                cap$c8,
                cap$c9,
                cap$c10,
                cap$c11)
                
model=crm(marked_dfH)
model
model=cjs.hessian(model)
model
```


Hudsonians location. Had to get rid of species fact stuff since this only has 1 spp


```{r}
str(marked_dfH)
marked_dfH$location.fac <- as.factor(marked_dfH$location)
marked_dfH$species.fac <- as.factor(marked_dfH$species)
modH <- crm(marked_dfH, 
        model="JS", 
        groups = c("location.fac"), 
        model.parameters=list(Phi = list(formula = ~location.fac), 
                              p = list(formula = ~1)))
modH$results$beta #found online but not sure how to use it
modH

cjs.hessian(modH)

str(modH)
# get values on real scale and not logit or log scales
modH$results$reals


modH$results$beta 
modH
modH$results$reals
```







# Run with RMark (need to download Program MARK in order for this to work). This is also looking at all species and locations

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_df, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta
```

CJS crimsons

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfC, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta
```

CJS hudsonians

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfH, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta
```




abundance/effort AIC vvvv

```{r}

data <- read.csv("Dragonfly1718Abundance.csv", stringsAsFactors = F)

### Each possible combination of variables needs to be analyzed.  The lowest score (not counting the full model?) wins. #####
mod1<-glm(data$adjusted.abundance~data$pH)
mod2<-glm(data$adjusted.abundance~data$elevation)
mod3<-glm(data$adjusted.abundance~data$fishpresence)
mod4<-glm(data$adjusted.abundance~data$lenticlotic)  
mod5<-glm(data$adjusted.abundance~data$openwater)
mod6<-glm(data$adjusted.abundance~data$pH*data$elevation)
mod7<-glm(data$adjusted.abundance~data$pH*data$elevation*data$fishpresence)
mod8<-glm(data$adjusted.abundance~data$pH*data$elevation*data$fishpresence*data$lenticlotic)
mod9<-glm(data$adjusted.abundance~data$pH*data$elevation*data$fishpresence*data$lenticlotic*data$openwater) 
mod10<-glm(data$adjusted.abundance~data$elevation*data$fishpresence)
mod11<-glm(data$adjusted.abundance~data$elevation*data$fishpresence*data$lenticlotic)
mod12<-glm(data$adjusted.abundance~data$elevation*data$fishpresence*data$lenticlotic*data$openwater)
mod13<-glm(data$adjusted.abundance~data$fishpresence*data$lenticlotic)
mod14<-glm(data$adjusted.abundance~data$fishpresence*data$openwater) #### Chicken dinner  #####
mod15<-glm(data$adjusted.abundance~data$fishpresence*data$lenticlotic*data$openwater) #### Almost the same ####
mod16<-glm(data$adjusted.abundance~data$lenticlotic*data$openwater)



AIC(mod1, k=2)  ### k = 2 is the "penalty" for adding more factors #####
AIC(mod2, k=2)
AIC(mod3, k=2)
AIC(mod4, k=2) 
AIC(mod5, k=2)
AIC(mod6, k=2)
AIC(mod7, k=2)
AIC(mod8, k=2)
AIC(mod9, k=2) 
AIC(mod10, k=2)
AIC(mod11, k=2)
AIC(mod12, k=2)
AIC(mod13, k=2)
AIC(mod14, k=2) #### Chicken dinner  #####
AIC(mod15, k=2) #### Almost the same, 0.1258 difference ####
AIC(mod16, k=2)


```




richness (just to see) vvvvv

```{r}
### Each possible combination of variables needs to be analyzed.  The lowest score (not counting the full model?) wins. #####
mod1<-glm(data$Richness~data$pH)
mod2<-glm(data$Richness~data$elevation)
mod3<-glm(data$Richness~data$fishpresence)
mod4<-glm(data$Richness~data$lenticlotic)  #### Chicken dinner  #####
mod5<-glm(data$Richness~data$openwater)
mod6<-glm(data$Richness~data$pH*data$elevation)
mod7<-glm(data$Richness~data$pH*data$elevation*data$fishpresence)
mod8<-glm(data$Richness~data$pH*data$elevation*data$fishpresence*data$lenticlotic)
mod9<-glm(data$Richness~data$pH*data$elevation*data$fishpresence*data$lenticlotic*data$openwater)
mod10<-glm(data$Richness~data$elevation*data$fishpresence)
mod11<-glm(data$Richness~data$elevation*data$fishpresence*data$lenticlotic)
mod12<-glm(data$Richness~data$elevation*data$fishpresence*data$lenticlotic*data$openwater)
mod13<-glm(data$Richness~data$fishpresence*data$lenticlotic)
mod14<-glm(data$Richness~data$fishpresence*data$openwater)
mod15<-glm(data$Richness~data$fishpresence*data$lenticlotic*data$openwater)
mod16<-glm(data$Richness~data$lenticlotic*data$openwater)



AIC(mod1, k=2)  ### k = 2 is the "penalty" for adding more factors #####
AIC(mod2, k=2)
AIC(mod3, k=2)
AIC(mod4, k=2) #### Chicken dinner  #####
AIC(mod5, k=2)
AIC(mod6, k=2)
AIC(mod7, k=2)
AIC(mod8, k=2)
AIC(mod9, k=2)
AIC(mod10, k=2)
AIC(mod11, k=2)
AIC(mod12, k=2)
AIC(mod13, k=2)
AIC(mod14, k=2)
AIC(mod15, k=2)
AIC(mod16, k=2)

```



these are all the JS and CJS for each location. Starting with NMBS
```{r}
capNMBS <- read.csv("capturehistoryNMBS.csv", stringsAsFactors = F)
str(capNMBS)
print(capNMBS)
summary(capNMBS)
capNMBS <- capNMBS[which(!is.na(capNMBS$c1)), ]
summary(capNMBS)

library(reshape)
## Format data for MARK

# get data formatted for MARK/RMark
capNMBS$ch <- paste(capNMBS$c1,
                capNMBS$c2,
                capNMBS$c3,
                capNMBS$c4,
                capNMBS$c5,
                capNMBS$c6,
                capNMBS$c7,
                capNMBS$c8,
                capNMBS$c9,
                capNMBS$c10,
                capNMBS$c11,
                " ",
                ";",
                sep="")


data=data.frame(capNMBS)
data
transform=melt(capNMBS, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot

```



```{r}
## Format data for marked package

marked_dfNMBS <- capNMBS

marked_dfNMBS$ch <- paste0(capNMBS$c1,
                capNMBS$c2,
                capNMBS$c3,
                capNMBS$c4,
                capNMBS$c5,
                capNMBS$c6,
                capNMBS$c7,
                capNMBS$c8,
                capNMBS$c9,
                capNMBS$c10,
                capNMBS$c11)
                
model=crm(marked_dfNMBS)
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_dfNMBS)
marked_dfNMBS$sex.fac <- as.factor(marked_dfNMBS$sex)
marked_dfNMBS$species.fac <- as.factor(marked_dfNMBS$species)
modNMBS <- crm(marked_dfNMBS, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
modNMBS$results$beta #found online but not sure how to use it
modNMBS

cjs.hessian(modNMBS)

str(modNMBS)
# get values on real scale and not logit or log scales
modNMBS$results$reals


modNMBS <- crm(marked_dfNMBS, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
modNMBS$results$beta 
modNMBS
modNMBS$results$reals
```


# Run with RMark (need to download Program MARK in order for this to work). This is looking at NMBS only

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfNMBS, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta


```


####okay now for CT

```{r}
capCT <- read.csv("capturehistoryCT.csv", stringsAsFactors = F)
str(capCT)
print(capCT)
summary(capCT)
capCT <- capCT[which(!is.na(capCT$c1)), ]
summary(capCT)

library(reshape)
## Format data for MARK

# get data formatted for MARK/RMark
capCT$ch <- paste(capCT$c1,
                capCT$c2,
                capCT$c3,
                capCT$c4,
                capCT$c5,
                capCT$c6,
                capCT$c7,
                capCT$c8,
                capCT$c9,
                capCT$c10,
                capCT$c11,
                " ",
                ";",
                sep="")


data=data.frame(capCT)
data
transform=melt(capCT, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot

```



```{r}
## Format data for marked package

marked_dfCT <- capCT

marked_dfCT$ch <- paste0(capCT$c1,
                capCT$c2,
                capCT$c3,
                capCT$c4,
                capCT$c5,
                capCT$c6,
                capCT$c7,
                capCT$c8,
                capCT$c9,
                capCT$c10,
                capCT$c11)
                
model=crm(marked_dfCT)
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_dfCT)
marked_dfCT$sex.fac <- as.factor(marked_dfCT$sex)
marked_dfCT$species.fac <- as.factor(marked_dfCT$species)
modCT <- crm(marked_dfCT, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
modCT$results$beta #found online but not sure how to use it
modCT

cjs.hessian(modCT)

str(modCT)
# get values on real scale and not logit or log scales
modCT$results$reals


modCT <- crm(marked_dfCT, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
modCT$results$beta 
modCT
modCT$results$reals
```


# Run with RMark (need to download Program MARK in order for this to work). This is looking at NMBS only

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfCT, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta


```




####okay now for HB

```{r}
capHB <- read.csv("capturehistoryHB.csv", stringsAsFactors = F)
str(capHB)
print(capHB)
summary(capHB)
capHB <- capHB[which(!is.na(capHB$c1)), ]
summary(capHB)

library(reshape)
## Format data for MARK

# get data formatted for MARK/RMark
capHB$ch <- paste(capHB$c1,
                capHB$c2,
                capHB$c3,
                capHB$c4,
                capHB$c5,
                capHB$c6,
                capHB$c7,
                capHB$c8,
                capHB$c9,
                capHB$c10,
                capHB$c11,
                " ",
                ";",
                sep="")


data=data.frame(capHB)
data
transform=melt(capHB, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot

```



```{r}
## Format data for marked package

marked_dfHB <- capHB

marked_dfHB$ch <- paste0(capHB$c1,
                capHB$c2,
                capHB$c3,
                capHB$c4,
                capHB$c5,
                capHB$c6,
                capHB$c7,
                capHB$c8,
                capHB$c9,
                capHB$c10,
                capHB$c11)
                
model=crm(marked_dfHB)
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_dfHB)
marked_dfHB$sex.fac <- as.factor(marked_dfHB$sex)
marked_dfHB$species.fac <- as.factor(marked_dfHB$species)
modHB <- crm(marked_dfHB, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
modHB$results$beta #found online but not sure how to use it
modHB

cjs.hessian(modHB)

str(modHB)
# get values on real scale and not logit or log scales
modHB$results$reals


modHB <- crm(marked_dfHB, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
modHB$results$beta 
modHB
modHB$results$reals
```


# Run with RMark (need to download Program MARK in order for this to work). This is looking at NMBS only

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfHB, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta


```







####okay now for NMBN

```{r}
capNMBN <- read.csv("capturehistoryNMBN.csv", stringsAsFactors = F)
str(capNMBN)
print(capNMBN)
summary(capNMBN)
capNMBN <- capNMBN[which(!is.na(capNMBN$c1)), ]
summary(capNMBN)

library(reshape)
## Format data for MARK

# get data formatted for MARK/RMark
capNMBN$ch <- paste(capNMBN$c1,
                capNMBN$c2,
                capNMBN$c3,
                capNMBN$c4,
                capNMBN$c5,
                capNMBN$c6,
                capNMBN$c7,
                capNMBN$c8,
                capNMBN$c9,
                capNMBN$c10,
                capNMBN$c11,
                " ",
                ";",
                sep="")


data=data.frame(capNMBN)
data
transform=melt(capNMBN, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot

```



```{r}
## Format data for marked package

marked_dfNMBN <- capNMBN

marked_dfNMBN$ch <- paste0(capNMBN$c1,
                capNMBN$c2,
                capNMBN$c3,
                capNMBN$c4,
                capNMBN$c5,
                capNMBN$c6,
                capNMBN$c7,
                capNMBN$c8,
                capNMBN$c9,
                capNMBN$c10,
                capNMBN$c11)
                
model=crm(marked_dfNMBN) 
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_dfNMBN)
marked_dfNMBN$sex.fac <- as.factor(marked_dfNMBN$sex)
marked_dfNMBN$species.fac <- as.factor(marked_dfNMBN$species)
modNMBN <- crm(marked_dfNMBN, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
modNMBN$results$beta #found online but not sure how to use it
modNMBN

cjs.hessian(modNMBN)

str(modNMBN)
# get values on real scale and not logit or log scales
modNMBN$results$reals


modNMBN <- crm(marked_dfNMBN, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
modNMBN$results$beta 
modNMBN
modNMBN$results$reals
```


# Run with RMark (need to download Program MARK in order for this to work). This is looking at NMBS only

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfNMBN, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta


```



####okay now for NMPN

```{r}
capNMPN <- read.csv("capturehistoryNMPN.csv", stringsAsFactors = F)
str(capNMPN)
print(capNMPN)
summary(capNMPN)
capNMPN <- capNMPN[which(!is.na(capNMPN$c1)), ]
summary(capNMPN)

library(reshape)
## Format data for MARK

# get data formatted for MARK/RMark
capNMPN$ch <- paste(capNMPN$c1,
                capNMPN$c2,
                capNMPN$c3,
                capNMPN$c4,
                capNMPN$c5,
                capNMPN$c6,
                capNMPN$c7,
                capNMPN$c8,
                capNMPN$c9,
                capNMPN$c10,
                capNMPN$c11,
                " ",
                ";",
                sep="")


data=data.frame(capNMPN)
data
transform=melt(capNMPN, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot

```



```{r}
## Format data for marked package

marked_dfNMPN <- capNMPN

marked_dfNMPN$ch <- paste0(capNMPN$c1,
                capNMPN$c2,
                capNMPN$c3,
                capNMPN$c4,
                capNMPN$c5,
                capNMPN$c6,
                capNMPN$c7,
                capNMPN$c8,
                capNMPN$c9,
                capNMPN$c10,
                capNMPN$c11)
                
model=crm(marked_dfNMPN) 
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_dfNMPN)
marked_dfNMPN$sex.fac <- as.factor(marked_dfNMPN$sex)
marked_dfNMPN$species.fac <- as.factor(marked_dfNMPN$species)
modNMPN <- crm(marked_dfNMPN, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
modNMPN$results$beta #found online but not sure how to use it
modNMPN

cjs.hessian(modNMPN)

str(modNMPN)
# get values on real scale and not logit or log scales
modNMPN$results$reals


modNMPN <- crm(marked_dfNMPN, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
modNMPN$results$beta 
modNMPN
modNMPN$results$reals
```


# Run with RMark (need to download Program MARK in order for this to work). This is looking at NMBS only

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfNMPN, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta


```



####okay now for NMPS

```{r}
capNMPS <- read.csv("capturehistoryNMPS.csv", stringsAsFactors = F)
str(capNMPS)
print(capNMPS)
summary(capNMPS)
capNMPS <- capNMPS[which(!is.na(capNMPS$c1)), ]
summary(capNMPS)

library(reshape)
## Format data for MARK

# get data formatted for MARK/RMark
capNMPS$ch <- paste(capNMPS$c1,
                capNMPS$c2,
                capNMPS$c3,
                capNMPS$c4,
                capNMPS$c5,
                capNMPS$c6,
                capNMPS$c7,
                capNMPS$c8,
                capNMPS$c9,
                capNMPS$c10,
                capNMPS$c11,
                " ",
                ";",
                sep="")


data=data.frame(capNMPS)
data
transform=melt(capNMPS, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot

```



```{r}
## Format data for marked package

marked_dfNMPS <- capNMPS

marked_dfNMPS$ch <- paste0(capNMPS$c1,
                capNMPS$c2,
                capNMPS$c3,
                capNMPS$c4,
                capNMPS$c5,
                capNMPS$c6,
                capNMPS$c7,
                capNMPS$c8,
                capNMPS$c9,
                capNMPS$c10,
                capNMPS$c11)
                
model=crm(marked_dfNMPS) 
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_dfNMPS)
marked_dfNMPS$sex.fac <- as.factor(marked_dfNMPS$sex)
marked_dfNMPS$species.fac <- as.factor(marked_dfNMPS$species)
modNMPS <- crm(marked_dfNMPS, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
modNMPS$results$beta #found online but not sure how to use it
modNMPS

cjs.hessian(modNMPS)

str(modNMPS)
# get values on real scale and not logit or log scales
modNMPS$results$reals


modNMPS <- crm(marked_dfNMPS, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
modNMPS$results$beta 
modNMPS
modNMPS$results$reals
```


# Run with RMark (need to download Program MARK in order for this to work). This is looking at NMPS only

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfNMPS, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta


```



####okay now for NCCB

```{r}
capNCCB <- read.csv("capturehistoryNCCB.csv", stringsAsFactors = F)
str(capNCCB)
print(capNCCB)
summary(capNCCB)
capNCCB <- capNCCB[which(!is.na(capNCCB$c1)), ]
summary(capNCCB)

library(reshape)
## Format data for MARK

# get data formatted for MARK/RMark
capNCCB$ch <- paste(capNCCB$c1,
                capNCCB$c2,
                capNCCB$c3,
                capNCCB$c4,
                capNCCB$c5,
                capNCCB$c6,
                capNCCB$c7,
                capNCCB$c8,
                capNCCB$c9,
                capNCCB$c10,
                capNCCB$c11,
                " ",
                ";",
                sep="")


data=data.frame(capNMPS)
data
transform=melt(capNCCB, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11;


pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(data$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

pivot

```



```{r}
## Format data for marked package

marked_dfNCCB <- capNCCB

marked_dfNCCB$ch <- paste0(capNCCB$c1,
                capNCCB$c2,
                capNCCB$c3,
                capNCCB$c4,
                capNCCB$c5,
                capNCCB$c6,
                capNCCB$c7,
                capNCCB$c8,
                capNCCB$c9,
                capNCCB$c10,
                capNCCB$c11)
                
model=crm(marked_dfNCCB) 
model
model=cjs.hessian(model)
model
```

looking at sex and species. phi= apparent survival estimate. p=capture probability (percents) N=population estimate

```{r}
str(marked_dfNCCB)
marked_dfNCCB$sex.fac <- as.factor(marked_dfNCCB$sex)
marked_dfNCCB$species.fac <- as.factor(marked_dfNCCB$species)
modNCCB <- crm(marked_dfNCCB, 
        model="JS", 
        groups = c("sex.fac"), 
        model.parameters=list(Phi = list(formula = ~sex.fac), 
                              p = list(formula = ~1)))
modNCCB$results$beta #found online but not sure how to use it
modNCCB

cjs.hessian(modNCCB)

str(modNCCB)
# get values on real scale and not logit or log scales
modNCCB$results$reals


modNCCB <- crm(marked_dfNCCB, 
        model="JS", 
        groups = c("species.fac"), 
        model.parameters=list(Phi = list(formula = ~species.fac), 
                              p = list(formula = ~species.fac)))
modNCCB$results$beta 
modNCCB
modNCCB$results$reals
```


# Run with RMark (need to download Program MARK in order for this to work). This is looking at NMPS only

```{r}
MarkPath='C:/Program Files (x86)/MARK'
mark(marked_dfNCCB, model.parameters=list(p=list(formula=~1)),output=FALSE)$results$beta


```













