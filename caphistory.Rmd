---
title: "caphistory"
author: "Bethany Liberto"
date: "January 10, 2019"
output: word_document
---
Using CJS and JS. JS -> for population estimates. CJS -> for time-dependent survival and recapture rates of a given species 
  
```{r}
library(marked)
library(RMark)
library(ggplot2)
library(reshape)
```


```{r}
cap <- read.csv("recapturehistory.csv", stringsAsFactors = F)
str(cap)
print(cap)
```

```{r}
# get data formatted for MARK/RMark

cap$ch <- paste(cap$c1,
                cap$c2,
                cap$c3,
                cap$c4,
                cap$c5,
                cap$c6,
                cap$c7,
                cap$c8,
                cap$c9,
                cap$c10,
                cap$c11,
                " ",
                ";",
                sep="")

data=data.frame(cap); data
transform=melt(cap, id.vars="mark.number")
pivot=cast(transform, mark.number ~ value)
pivot[is.na(pivot)]=0

pivot[,2:ncol(pivot)][pivot[,2:ncol(pivot)] != 0] = 1
lh <- 11

pivot$eh <- apply(pivot[2:lh],1,paste,collapse="") # concatenates encounter columns into eh
pivot[2:lh] <- NULL # drops individual encounter columns
# create commented tag
pivot$mark.number <- paste("/*", pivot$mark.number, "*/", sep=" ")
# sort by descending encounter histories
pivot <- pivot[order(cap$ch,decreasing=TRUE),]
# tack on the frequency for the individual
pivot$end <- "1;";
# write out the input file
write.table(pivot,file="cjs-pivot.inp",sep=" ",quote=F,col.names=F,row.names=F);

model=crm(cap)
model
model=cjs.hessian(model)
model
```



```{r}
mod=crm(cap,model="JS",groups="Sex",model.parameters=list(Phi=list(formula=~Sex),p=list(formula=~code)))
mod$results$beta #found online but not sure how to use it
```

```{r}
Model.1 = mark(hw.proc,hw.ddl,model.parameters=list(Phi=Phi.ct,p=p.ct),output = FALSE,delete=T) #found online as well but don't know how to use it
```



